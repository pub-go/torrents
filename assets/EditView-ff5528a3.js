import{q as U,o as i,p as S,A as y,W as C,V as c,aZ as D,N as _,a1 as w,$ as p,E as d,aW as o,Z as E,a0 as L,aV as I}from"./index-6da31c5a.js";import{k as $,l as F,m as V,n as R,B as m,_ as T,f as W,h as Z,g as j}from"./DictEdit.vue_vue_type_script_setup_true_lang-03ff2037.js";function q(u){return new M(u).readValue()}const z="0".charCodeAt(0),O="9".charCodeAt(0),G="i".charCodeAt(0),H="l".charCodeAt(0),J="d".charCodeAt(0),K=":".charCodeAt(0),v="e".charCodeAt(0);class M{a;idx=0;constructor(e){this.a=e}reset(){this.idx=0}read(){return this.a[this.idx++]}unread(){this.idx--}readValue(){const e=this.read();if(e>=z&&e<=O)return this.unread(),this.readString();if(e===G)return new $(this.readIntUitl(v));if(e===H)return this.readList();if(e===J)return this.readDict();throw new Error("invalid input")}readString(){const e=this.readIntUitl(K),a=[];for(let t=0;t<e;t++)a.push(this.read());return new F(new Uint8Array(a))}readIntUitl(e){const a=[];let t;for(;;){if(t=this.read(),t===void 0)throw new Error(`EOF reached when idx=${this.idx}`);if(t===e)break;a.push(t)}const s=V(new Uint8Array(a)),l=parseInt(s,10);if(isNaN(l))throw new Error(`NaN: ${s}`);return l}readList(){const e=[];for(;this.read()!==v;)this.unread(),e.push(this.readValue());return new R(e)}readDict(){const e={};for(;this.read()!==v;){this.unread();const t=this.readString(),s=this.readValue();e[V(t.value)]=s}return new m(e)}}const P=w("i",{i:"ep-upload-filled",class:"el-icon--upload inline-flex"},null,-1),Q={class:"el-upload__text"},X={class:"flex justify-between"},te=U({__name:"EditView",setup(u){const e=i(!1),a=i(),t=i([]),s=r=>{a.value.clearFiles();const n=r[0];a.value.handleStart(n),e.value=!1},l=()=>{a.value?.clearFiles(),h.value=new m({}),e.value=!1},k=S(()=>t.value.length===0),f=i(!1),b=async()=>{f.value=!0;try{console.log("ready to read");const r=await t.value[0].raw.slice().arrayBuffer();console.log("buffer:",r);const n=q(new Uint8Array(r));if(n.Type()!=="dict")throw new Error(o("not torrent file"));h.value=n,x.value=t.value[0].name,e.value=!0}catch(r){W.error({title:o("Error"),message:I(o("Can not view this file: {0}"),r)})}f.value=!1},h=i(new m({})),x=i("");return(r,n)=>{const A=Z,g=j,B=D;return y(),C(B,{class:"is-vertical"},{default:c(()=>[_(A,{ref_key:"uploadRef",ref:a,drag:"","auto-upload":!1,"file-list":t.value,"onUpdate:fileList":n[0]||(n[0]=N=>t.value=N),limit:1,accept:".torrent,application/x-bittorrent","on-exceed":s},{default:c(()=>[P,w("div",Q,p(d(o)("Drop file here or click to upload")),1)]),_:1},8,["file-list"]),w("div",X,[_(g,{onClick:l},{default:c(()=>[E(p(d(o)("Reset")),1)]),_:1}),_(g,{type:"primary",disabled:d(k),onClick:b,loading:f.value},{default:c(()=>[E(p(d(o)("View")),1)]),_:1},8,["disabled","loading"])]),e.value?(y(),C(T,{key:0,data:h.value,name:x.value},null,8,["data","name"])):L("",!0)]),_:1})}}});export{te as default};
