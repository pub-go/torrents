import{q as U,o,p as S,A as y,W as C,V as l,aZ as D,N as u,a1 as h,$ as w,E as f,aW as i,Z as m,a0 as L,aV as I}from"./index-5df865d4.js";import{k as $,l as F,m as k,n as R,B as x,_ as T,f as W,h as Z,g as j}from"./DictView.vue_vue_type_script_setup_true_lang-e4de7555.js";function q(_){return new M(_).readValue()}const z="0".charCodeAt(0),O="9".charCodeAt(0),G="i".charCodeAt(0),H="l".charCodeAt(0),J="d".charCodeAt(0),K=":".charCodeAt(0),g="e".charCodeAt(0);class M{a;idx=0;constructor(e){this.a=e}reset(){this.idx=0}read(){return this.a[this.idx++]}unread(){this.idx--}readValue(){const e=this.read();if(e>=z&&e<=O)return this.unread(),this.readString();if(e===G)return new $(this.readIntUitl(g));if(e===H)return this.readList();if(e===J)return this.readDict();throw new Error("invalid input")}readString(){const e=this.readIntUitl(K),a=[];for(let t=0;t<e;t++)a.push(this.read());return new F(new Uint8Array(a))}readIntUitl(e){const a=[];let t;for(;;){if(t=this.read(),t===void 0)throw new Error(`EOF reached when idx=${this.idx}`);if(t===e)break;a.push(t)}const s=k(new Uint8Array(a)),c=parseInt(s,10);if(isNaN(c))throw new Error(`NaN: ${s}`);return c}readList(){const e=[];for(;this.read()!==g;)this.unread(),e.push(this.readValue());return new R(e)}readDict(){const e={};for(;this.read()!==g;){this.unread();const t=this.readString(),s=this.readValue();e[k(t.value)]=s}return new x(e)}}const P=h("i",{i:"ep-upload-filled",class:"el-icon--upload inline-flex"},null,-1),Q={class:"el-upload__text"},X={class:"flex justify-between"},Y={hidden:""},ae=U({__name:"EditView",setup(_){const e=o(!1),a=o(),t=o([]),s=n=>{a.value.clearFiles();const r=n[0];a.value.handleStart(r),e.value=!1},c=()=>{a.value?.clearFiles(),d.value=new x({}),e.value=!1},E=S(()=>t.value.length===0),p=o(!1),V=async()=>{p.value=!0;try{console.log("ready to read");const n=await t.value[0].raw.slice().arrayBuffer();console.log("buffer:",n);const r=q(new Uint8Array(n));if(r.Type()!=="dict")throw new Error(i("not torrent file"));d.value=r,e.value=!0}catch(n){W.error({title:i("Error"),message:I(i("Can not view this file: {0}"),n)})}p.value=!1},d=o(new x({})),b=()=>{console.log(d.value)};return(n,r)=>{const A=Z,v=j,B=D;return y(),C(B,{class:"is-vertical"},{default:l(()=>[u(A,{ref_key:"uploadRef",ref:a,drag:"","auto-upload":!1,"file-list":t.value,"onUpdate:fileList":r[0]||(r[0]=N=>t.value=N),limit:1,accept:".torrent,application/x-bittorrent","on-exceed":s},{default:l(()=>[P,h("div",Q,w(f(i)("Drop file here or click to upload")),1)]),_:1},8,["file-list"]),h("div",X,[u(v,{onClick:c},{default:l(()=>[m(w(f(i)("Reset")),1)]),_:1}),u(v,{type:"primary",disabled:f(E),onClick:V,loading:p.value},{default:l(()=>[m(w(f(i)("View")),1)]),_:1},8,["disabled","loading"])]),e.value?(y(),C(T,{key:0,data:d.value,name:"root"},null,8,["data"])):L("",!0),h("div",Y,[u(v,{onClick:b},{default:l(()=>[m("log")]),_:1})])]),_:1})}}});export{ae as default};
