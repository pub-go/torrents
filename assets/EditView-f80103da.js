import{k as U,r as i,j as S,o as g,Q as C,P as c,aC as D,H as _,W as w,U as p,y as d,az as o,T as E,V as L,ay as I}from"./index-065cae13.js";import{m as F,n as R,o as k,p as T,B as m,_ as $,E as j,g as z,f as H}from"./DictEdit.vue_vue_type_script_setup_true_lang-1a9afde2.js";function O(u){return new K(u).readValue()}const P="0".charCodeAt(0),Q="9".charCodeAt(0),W="i".charCodeAt(0),q="l".charCodeAt(0),G="d".charCodeAt(0),J=":".charCodeAt(0),v="e".charCodeAt(0);class K{a;idx=0;constructor(e){this.a=e}reset(){this.idx=0}read(){return this.a[this.idx++]}unread(){this.idx--}readValue(){const e=this.read();if(e>=P&&e<=Q)return this.unread(),this.readString();if(e===W)return new F(this.readIntUitl(v));if(e===q)return this.readList();if(e===G)return this.readDict();throw new Error("invalid input")}readString(){const e=this.readIntUitl(J),a=[];for(let t=0;t<e;t++)a.push(this.read());return new R(new Uint8Array(a))}readIntUitl(e){const a=[];let t;for(;;){if(t=this.read(),t===void 0)throw new Error(`EOF reached when idx=${this.idx}`);if(t===e)break;a.push(t)}const s=k(new Uint8Array(a)),l=parseInt(s,10);if(isNaN(l))throw new Error(`NaN: ${s}`);return l}readList(){const e=[];for(;this.read()!==v;)this.unread(),e.push(this.readValue());return new T(e)}readDict(){const e={};for(;this.read()!==v;){this.unread();const t=this.readString(),s=this.readValue();e[k(t.value)]=s}return new m(e)}}const M=w("i",{i:"ep-upload-filled",class:"el-icon--upload inline-flex"},null,-1),X={class:"el-upload__text"},Y={class:"flex justify-between"},te=U({__name:"EditView",setup(u){const e=i(!1),a=i(),t=i([]),s=r=>{a.value.clearFiles();const n=r[0];a.value.handleStart(n),e.value=!1},l=()=>{a.value?.clearFiles(),h.value=new m({}),e.value=!1},V=S(()=>t.value.length===0),f=i(!1),b=async()=>{f.value=!0;try{console.log("ready to read");const r=await t.value[0].raw.slice().arrayBuffer();console.log("buffer:",r);const n=O(new Uint8Array(r));if(n.Type()!=="dict")throw new Error(o("not torrent file"));h.value=n,y.value=t.value[0].name,e.value=!0}catch(r){j.error({title:o("Error"),message:I(o("Can not view this file: {0}"),r)})}f.value=!1},h=i(new m({})),y=i("");return(r,n)=>{const B=z,x=H,A=D;return g(),C(A,{class:"is-vertical"},{default:c(()=>[_(B,{ref_key:"uploadRef",ref:a,drag:"","auto-upload":!1,"file-list":t.value,"onUpdate:fileList":n[0]||(n[0]=N=>t.value=N),limit:1,accept:".torrent,application/x-bittorrent","on-exceed":s},{default:c(()=>[M,w("div",X,p(d(o)("Drop file here or click to upload")),1)]),_:1},8,["file-list"]),w("div",Y,[_(x,{onClick:l},{default:c(()=>[E(p(d(o)("Reset")),1)]),_:1}),_(x,{type:"primary",disabled:d(V),onClick:b,loading:f.value},{default:c(()=>[E(p(d(o)("View")),1)]),_:1},8,["disabled","loading"])]),e.value?(g(),C($,{key:0,data:h.value,name:y.value},null,8,["data","name"])):L("",!0)]),_:1})}}});export{te as default};
