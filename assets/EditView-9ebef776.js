import{k as S,r as o,j as D,Q as C,P as l,aC as L,o as b,H as f,W as y,U as h,y as c,az as a,T as m,V as I,ay as T}from"./index-ad8d61cb.js";import{m as F,n as R,o as k,p as $,B as x,_ as j,t as z,q,E as H,g as O,f as P}from"./DictEdit.vue_vue_type_script_setup_true_lang-f6b49bda.js";function Q(p){return new Y(p).readValue()}const W="0".charCodeAt(0),G="9".charCodeAt(0),J="i".charCodeAt(0),K="l".charCodeAt(0),M="d".charCodeAt(0),X=":".charCodeAt(0),g="e".charCodeAt(0);class Y{a;idx=0;constructor(e){this.a=e}reset(){this.idx=0}read(){return this.a[this.idx++]}unread(){this.idx--}readValue(){const e=this.read();if(e>=W&&e<=G)return this.unread(),this.readString();if(e===J)return new F(this.readIntUitl(g));if(e===K)return this.readList();if(e===M)return this.readDict();throw new Error("invalid input")}readString(){const e=this.readIntUitl(X),n=[];for(let t=0;t<e;t++)n.push(this.read());return new R(new Uint8Array(n))}readIntUitl(e){const n=[];let t;for(;;){if(t=this.read(),t===void 0)throw new Error(`EOF reached when idx=${this.idx}`);if(t===e)break;n.push(t)}const i=k(new Uint8Array(n)),d=parseInt(i,10);if(isNaN(d))throw new Error(`NaN: ${i}`);return d}readList(){const e=[];for(;this.read()!==g;)this.unread(),e.push(this.readValue());return new $(e)}readDict(){const e={};for(;this.read()!==g;){this.unread();const t=this.readString(),i=this.readValue();e[k(t.value)]=i}return new x(e)}}const Z=y("i",{i:"ep-upload-filled",class:"el-icon--upload inline-flex"},null,-1),ee={class:"el-upload__text"},te={class:"flex justify-between"},re=S({__name:"EditView",setup(p){const e=o(!1),n=o(),t=o([]),i=r=>{n.value.clearFiles();const s=r[0];n.value.handleStart(s),e.value=!1},d=()=>{n.value?.clearFiles(),u.value=new x({}),e.value=!1},E=()=>{n.value?.clearFiles(),v.value=a("new_torrent"),u.value=z({announce:a("https://tracker.url/announce"),comment:a("comments"),"created by":"https://pub-go.github.io/torrents/","creation date":new Date().getTime()/1e3,info:{name:a("torrent name: file/folder name"),"piece length":524288,pieces:q(a("<piece sha1>")),private:0,length:0,files:[{length:0,path:[a("sub folder"),a("file name")]}],source:a("source")}}),e.value=!0},V=D(()=>t.value.length===0),_=o(!1),B=async()=>{_.value=!0;try{console.log("ready to read");const r=await t.value[0].raw.slice().arrayBuffer();console.log("buffer:",r);const s=Q(new Uint8Array(r));if(s.Type()!=="dict")throw new Error(a("not torrent file"));u.value=s,v.value=t.value[0].name,e.value=!0}catch(r){H.error({title:a("Error"),message:T(a("Can not view this file: {0}"),r)})}_.value=!1},u=o(new x({})),v=o("");return(r,s)=>{const N=O,w=P,A=L;return b(),C(A,{class:"is-vertical"},{default:l(()=>[f(N,{ref_key:"uploadRef",ref:n,drag:"","auto-upload":!1,"file-list":t.value,"onUpdate:fileList":s[0]||(s[0]=U=>t.value=U),limit:1,accept:".torrent,application/x-bittorrent","on-exceed":i},{default:l(()=>[Z,y("div",ee,h(c(a)("Drop file here or click to upload")),1)]),_:1},8,["file-list"]),y("div",te,[f(w,{onClick:d},{default:l(()=>[m(h(c(a)("Reset")),1)]),_:1}),f(w,{onClick:E},{default:l(()=>[m(h(c(a)("New")),1)]),_:1}),f(w,{type:"primary",disabled:c(V),onClick:B,loading:_.value},{default:l(()=>[m(h(c(a)("View")),1)]),_:1},8,["disabled","loading"])]),e.value?(b(),C(j,{key:0,data:u.value,name:v.value},null,8,["data","name"])):I("",!0)]),_:1})}}});export{re as default};
